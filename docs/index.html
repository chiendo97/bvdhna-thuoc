<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.min.mjs" type="module"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #525659;
        }

        .header {
            padding: 0.75rem 1rem;
            background: #323639;
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
            border: none;
            border-radius: 4px;
            background: #525659;
            color: #fff;
            outline: none;
        }

        .search-input::placeholder {
            color: #aaa;
        }

        .search-input:focus {
            background: #626669;
        }

        .page-select {
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
            min-width: 200px;
            border: none;
            border-radius: 4px;
            background: #525659;
            color: #fff;
            cursor: pointer;
        }

        .nav-buttons {
            display: flex;
            gap: 0.25rem;
        }

        .nav-btn {
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
            border: none;
            border-radius: 4px;
            background: #525659;
            color: #fff;
            cursor: pointer;
            transition: background 0.2s;
        }

        .nav-btn:hover {
            background: #626669;
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .page-info {
            font-size: 0.85rem;
            color: #aaa;
            white-space: nowrap;
        }

        .zoom-controls {
            display: flex;
            gap: 0.25rem;
            align-items: center;
        }

        .zoom-btn {
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
            border: none;
            border-radius: 4px;
            background: #525659;
            color: #fff;
            cursor: pointer;
            transition: background 0.2s;
        }

        .zoom-btn:hover {
            background: #626669;
        }

        .zoom-level {
            color: #aaa;
            font-size: 0.85rem;
            min-width: 50px;
            text-align: center;
        }

        .viewer {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            gap: 10px;
        }

        .viewer canvas {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            background: white;
        }

        .loading {
            color: #aaa;
            font-size: 1.2rem;
            padding: 2rem;
        }

        .no-results {
            color: #aaa;
            font-size: 1.2rem;
            padding: 2rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <input type="text" class="search-input" id="search" placeholder="Search by name...">
        <select class="page-select" id="pageSelect">
            <option value="0" data-name="acyclovir">Acyclovir (1, 2)</option>
            <option value="1" data-name="amikacin">Amikacin (2)</option>
            <option value="2" data-name="amoxicillin">Amoxicillin (3)</option>
            <option value="3" data-name="acid clavulanic">Acid clavulanic (3)</option>
            <option value="4" data-name="sulbactam">Sulbactam (3, 4)</option>
            <option value="5" data-name="anidulafungin">Anidulafungin (4)</option>
            <option value="6" data-name="azithromycin">Azithromycin (4)</option>
            <option value="7" data-name="caspofungin">Caspofungin (4)</option>
            <option value="8" data-name="cefaclor">Cefaclor (4)</option>
            <option value="9" data-name="cefalexin">Cefalexin (4)</option>
            <option value="10" data-name="cefamandol">Cefamandol (5)</option>
            <option value="11" data-name="cefazolin">Cefazolin (5)</option>
            <option value="12" data-name="cefdinir">Cefdinir (5)</option>
            <option value="13" data-name="cefepim">Cefepim (6)</option>
            <option value="14" data-name="cefixim">Cefixim (6)</option>
            <option value="15" data-name="cefoperazon">Cefoperazon (6)</option>
            <option value="16" data-name="cefoperazon + sulbactam">Cefoperazon + sulbactam (7)</option>
            <option value="17" data-name="cefotaxim">Cefotaxim (7)</option>
            <option value="18" data-name="cefotiam">Cefotiam (7)</option>
            <option value="19" data-name="cefpirom">Cefpirom (7, 8)</option>
            <option value="20" data-name="ceftazidim">Ceftazidim (8)</option>
            <option value="21" data-name="ceftazidim + avibactam">Ceftazidim + avibactam (8)</option>
            <option value="22" data-name="ceftibuten">Ceftibuten (9)</option>
            <option value="23" data-name="ceftizoxim">Ceftizoxim (9)</option>
            <option value="24" data-name="ceftolozan + tazobactam">Ceftolozan + tazobactam (9)</option>
            <option value="25" data-name="ceftriaxon">Ceftriaxon (9, 10)</option>
            <option value="26" data-name="cefuroxim">Cefuroxim (10)</option>
            <option value="27" data-name="cefalexin (2)">Cefalexin (2) (10)</option>
            <option value="28" data-name="ciprofloxacin">Ciprofloxacin (11)</option>
            <option value="29" data-name="clarithromycin">Clarithromycin (11)</option>
            <option value="30" data-name="clindamycin">Clindamycin (11)</option>
            <option value="31" data-name="doripenem">Doripenem (12)</option>
            <option value="32" data-name="doxycyclin">Doxycyclin (12)</option>
            <option value="33" data-name="ertapenem">Ertapenem (12)</option>
            <option value="34" data-name="fluconazol">Fluconazol (13)</option>
            <option value="35" data-name="fosfomycin">Fosfomycin (13, 14)</option>
            <option value="36" data-name="gentamicin">Gentamicin (14, 15)</option>
            <option value="37" data-name="imipenem + cilastatin">Imipenem + cilastatin (15)</option>
            <option value="38" data-name="itraconazol">Itraconazol (16)</option>
            <option value="39" data-name="levofloxacin">Levofloxacin (16)</option>
            <option value="40" data-name="linezolid">Linezolid (17)</option>
            <option value="41" data-name="meropenem">Meropenem (17)</option>
            <option value="42" data-name="metronidazol">Metronidazol (17)</option>
            <option value="43" data-name="moxifloxacin">Moxifloxacin (17)</option>
            <option value="44" data-name="ofloxacin">Ofloxacin (18)</option>
            <option value="45" data-name="piperacilin + tazobactam">Piperacilin + tazobactam (18)</option>
            <option value="46" data-name="co-trimoxazol">Co-trimoxazol (19)</option>
            <option value="47" data-name="ticarcilin + acid clavulanic">Ticarcilin + acid clavulanic (19)</option>
            <option value="48" data-name="tinidazol">Tinidazol (20)</option>
            <option value="49" data-name="tobramycin">Tobramycin (20)</option>
            <option value="50" data-name="vancomycin">Vancomycin (21)</option>
            <option value="51" data-name="voriconazol">Voriconazol (22)</option>
            <option value="52" data-name="colistin">Colistin (23, 24)</option>
            <option value="53" data-name="danh mục từ viết tắt">Danh mục từ viết tắt (25)</option>
        </select>
        <div class="nav-buttons">
            <button class="nav-btn" id="prevBtn" title="Previous">&larr; Prev</button>
            <button class="nav-btn" id="nextBtn" title="Next">Next &rarr;</button>
        </div>
        <div class="zoom-controls">
            <button class="zoom-btn" id="zoomOut" title="Zoom out">-</button>
            <span class="zoom-level" id="zoomLevel">100%</span>
            <button class="zoom-btn" id="zoomIn" title="Zoom in">+</button>
            <button class="zoom-btn" id="zoomFit" title="Fit width">Fit</button>
        </div>
        <span class="page-info" id="pageInfo"></span>
    </div>
    <div class="viewer" id="viewerContainer">
        <div class="loading">Loading PDF...</div>
    </div>

    <script type="module">
        // Import PDF.js
        const pdfjsLib = await import('https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.min.mjs');
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.worker.min.mjs';

        const search = document.getElementById('search');
        const pageSelect = document.getElementById('pageSelect');
        const viewerContainer = document.getElementById('viewerContainer');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const pageInfo = document.getElementById('pageInfo');
        const zoomIn = document.getElementById('zoomIn');
        const zoomOut = document.getElementById('zoomOut');
        const zoomFit = document.getElementById('zoomFit');
        const zoomLevel = document.getElementById('zoomLevel');

        // Embedded entries data
        const allEntries = [
  {
    "name": "Acyclovir",
    "pages": [
      1,
      2
    ],
    "files": [
      "page_1.pdf",
      "page_2.pdf"
    ]
  },
  {
    "name": "Amikacin",
    "pages": [
      2
    ],
    "files": [
      "page_2.pdf"
    ]
  },
  {
    "name": "Amoxicillin",
    "pages": [
      3
    ],
    "files": [
      "page_3.pdf"
    ]
  },
  {
    "name": "Acid clavulanic",
    "pages": [
      3
    ],
    "files": [
      "page_3.pdf"
    ]
  },
  {
    "name": "Sulbactam",
    "pages": [
      3,
      4
    ],
    "files": [
      "page_3.pdf",
      "page_4.pdf"
    ]
  },
  {
    "name": "Anidulafungin",
    "pages": [
      4
    ],
    "files": [
      "page_4.pdf"
    ]
  },
  {
    "name": "Azithromycin",
    "pages": [
      4
    ],
    "files": [
      "page_4.pdf"
    ]
  },
  {
    "name": "Caspofungin",
    "pages": [
      4
    ],
    "files": [
      "page_4.pdf"
    ]
  },
  {
    "name": "Cefaclor",
    "pages": [
      4
    ],
    "files": [
      "page_4.pdf"
    ]
  },
  {
    "name": "Cefalexin",
    "pages": [
      4
    ],
    "files": [
      "page_4.pdf"
    ]
  },
  {
    "name": "Cefamandol",
    "pages": [
      5
    ],
    "files": [
      "page_5.pdf"
    ]
  },
  {
    "name": "Cefazolin",
    "pages": [
      5
    ],
    "files": [
      "page_5.pdf"
    ]
  },
  {
    "name": "Cefdinir",
    "pages": [
      5
    ],
    "files": [
      "page_5.pdf"
    ]
  },
  {
    "name": "Cefepim",
    "pages": [
      6
    ],
    "files": [
      "page_6.pdf"
    ]
  },
  {
    "name": "Cefixim",
    "pages": [
      6
    ],
    "files": [
      "page_6.pdf"
    ]
  },
  {
    "name": "Cefoperazon",
    "pages": [
      6
    ],
    "files": [
      "page_6.pdf"
    ]
  },
  {
    "name": "Cefoperazon + sulbactam",
    "pages": [
      7
    ],
    "files": [
      "page_7.pdf"
    ]
  },
  {
    "name": "Cefotaxim",
    "pages": [
      7
    ],
    "files": [
      "page_7.pdf"
    ]
  },
  {
    "name": "Cefotiam",
    "pages": [
      7
    ],
    "files": [
      "page_7.pdf"
    ]
  },
  {
    "name": "Cefpirom",
    "pages": [
      7,
      8
    ],
    "files": [
      "page_7.pdf",
      "page_8.pdf"
    ]
  },
  {
    "name": "Ceftazidim",
    "pages": [
      8
    ],
    "files": [
      "page_8.pdf"
    ]
  },
  {
    "name": "Ceftazidim + avibactam",
    "pages": [
      8
    ],
    "files": [
      "page_8.pdf"
    ]
  },
  {
    "name": "Ceftibuten",
    "pages": [
      9
    ],
    "files": [
      "page_9.pdf"
    ]
  },
  {
    "name": "Ceftizoxim",
    "pages": [
      9
    ],
    "files": [
      "page_9.pdf"
    ]
  },
  {
    "name": "Ceftolozan + tazobactam",
    "pages": [
      9
    ],
    "files": [
      "page_9.pdf"
    ]
  },
  {
    "name": "Ceftriaxon",
    "pages": [
      9,
      10
    ],
    "files": [
      "page_9.pdf",
      "page_10.pdf"
    ]
  },
  {
    "name": "Cefuroxim",
    "pages": [
      10
    ],
    "files": [
      "page_10.pdf"
    ]
  },
  {
    "name": "Cefalexin (2)",
    "pages": [
      10
    ],
    "files": [
      "page_10.pdf"
    ]
  },
  {
    "name": "Ciprofloxacin",
    "pages": [
      11
    ],
    "files": [
      "page_11.pdf"
    ]
  },
  {
    "name": "Clarithromycin",
    "pages": [
      11
    ],
    "files": [
      "page_11.pdf"
    ]
  },
  {
    "name": "Clindamycin",
    "pages": [
      11
    ],
    "files": [
      "page_11.pdf"
    ]
  },
  {
    "name": "Doripenem",
    "pages": [
      12
    ],
    "files": [
      "page_12.pdf"
    ]
  },
  {
    "name": "Doxycyclin",
    "pages": [
      12
    ],
    "files": [
      "page_12.pdf"
    ]
  },
  {
    "name": "Ertapenem",
    "pages": [
      12
    ],
    "files": [
      "page_12.pdf"
    ]
  },
  {
    "name": "Fluconazol",
    "pages": [
      13
    ],
    "files": [
      "page_13.pdf"
    ]
  },
  {
    "name": "Fosfomycin",
    "pages": [
      13,
      14
    ],
    "files": [
      "page_13.pdf",
      "page_14.pdf"
    ]
  },
  {
    "name": "Gentamicin",
    "pages": [
      14,
      15
    ],
    "files": [
      "page_14.pdf",
      "page_15.pdf"
    ]
  },
  {
    "name": "Imipenem + cilastatin",
    "pages": [
      15
    ],
    "files": [
      "page_15.pdf"
    ]
  },
  {
    "name": "Itraconazol",
    "pages": [
      16
    ],
    "files": [
      "page_16.pdf"
    ]
  },
  {
    "name": "Levofloxacin",
    "pages": [
      16
    ],
    "files": [
      "page_16.pdf"
    ]
  },
  {
    "name": "Linezolid",
    "pages": [
      17
    ],
    "files": [
      "page_17.pdf"
    ]
  },
  {
    "name": "Meropenem",
    "pages": [
      17
    ],
    "files": [
      "page_17.pdf"
    ]
  },
  {
    "name": "Metronidazol",
    "pages": [
      17
    ],
    "files": [
      "page_17.pdf"
    ]
  },
  {
    "name": "Moxifloxacin",
    "pages": [
      17
    ],
    "files": [
      "page_17.pdf"
    ]
  },
  {
    "name": "Ofloxacin",
    "pages": [
      18
    ],
    "files": [
      "page_18.pdf"
    ]
  },
  {
    "name": "Piperacilin + tazobactam",
    "pages": [
      18
    ],
    "files": [
      "page_18.pdf"
    ]
  },
  {
    "name": "Co-trimoxazol",
    "pages": [
      19
    ],
    "files": [
      "page_19.pdf"
    ]
  },
  {
    "name": "Ticarcilin + acid clavulanic",
    "pages": [
      19
    ],
    "files": [
      "page_19.pdf"
    ]
  },
  {
    "name": "Tinidazol",
    "pages": [
      20
    ],
    "files": [
      "page_20.pdf"
    ]
  },
  {
    "name": "Tobramycin",
    "pages": [
      20
    ],
    "files": [
      "page_20.pdf"
    ]
  },
  {
    "name": "Vancomycin",
    "pages": [
      21
    ],
    "files": [
      "page_21.pdf"
    ]
  },
  {
    "name": "Voriconazol",
    "pages": [
      22
    ],
    "files": [
      "page_22.pdf"
    ]
  },
  {
    "name": "Colistin",
    "pages": [
      23,
      24
    ],
    "files": [
      "page_23.pdf",
      "page_24.pdf"
    ]
  },
  {
    "name": "Danh mục từ viết tắt",
    "pages": [
      25
    ],
    "files": [
      "page_25.pdf"
    ]
  }
];

        let currentEntries = [...allEntries];
        let currentScale = 1.5;
        let loadedPdfs = [];

        function updateZoomDisplay() {
            zoomLevel.textContent = Math.round(currentScale * 100 / 1.5) + '%';
        }

        function updatePageInfo() {
            const currentIndex = pageSelect.selectedIndex;
            const total = pageSelect.options.length;
            if (total > 0) {
                pageInfo.textContent = `Entry ${currentIndex + 1} of ${total}`;
            } else {
                pageInfo.textContent = '';
            }
            prevBtn.disabled = currentIndex <= 0;
            nextBtn.disabled = currentIndex >= total - 1;
        }

        async function renderPage(pdf, pageNum, container) {
            const page = await pdf.getPage(pageNum);
            const viewport = page.getViewport({ scale: currentScale });

            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            await page.render({
                canvasContext: context,
                viewport: viewport
            }).promise;

            container.appendChild(canvas);
        }

        async function loadAndRenderPdf(url, container) {
            try {
                const pdf = await pdfjsLib.getDocument(url).promise;
                loadedPdfs.push(pdf);

                // Render all pages of this PDF
                for (let i = 1; i <= pdf.numPages; i++) {
                    await renderPage(pdf, i, container);
                }
            } catch (error) {
                console.error('Error loading PDF:', error);
                const errorDiv = document.createElement('div');
                errorDiv.className = 'no-results';
                errorDiv.textContent = 'Error loading PDF';
                container.appendChild(errorDiv);
            }
        }

        async function updateViewer() {
            const selectedIdx = pageSelect.selectedIndex;
            if (selectedIdx < 0 || currentEntries.length === 0) {
                viewerContainer.innerHTML = '<div class="no-results">No matching entries found</div>';
                updatePageInfo();
                return;
            }

            viewerContainer.innerHTML = '<div class="loading">Loading PDF...</div>';
            loadedPdfs = [];

            const entry = currentEntries[selectedIdx];
            viewerContainer.innerHTML = '';

            // Load and render each PDF file
            for (const file of entry.files) {
                await loadAndRenderPdf('pages/' + file, viewerContainer);
            }

            updatePageInfo();
        }

        async function rerender() {
            const selectedIdx = pageSelect.selectedIndex;
            if (selectedIdx < 0 || currentEntries.length === 0) return;

            viewerContainer.innerHTML = '';

            for (const pdf of loadedPdfs) {
                for (let i = 1; i <= pdf.numPages; i++) {
                    await renderPage(pdf, i, viewerContainer);
                }
            }
        }

        pageSelect.addEventListener('change', updateViewer);

        prevBtn.addEventListener('click', () => {
            if (pageSelect.selectedIndex > 0) {
                pageSelect.selectedIndex--;
                updateViewer();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (pageSelect.selectedIndex < pageSelect.options.length - 1) {
                pageSelect.selectedIndex++;
                updateViewer();
            }
        });

        zoomIn.addEventListener('click', () => {
            currentScale = Math.min(currentScale + 0.25, 4);
            updateZoomDisplay();
            rerender();
        });

        zoomOut.addEventListener('click', () => {
            currentScale = Math.max(currentScale - 0.25, 0.5);
            updateZoomDisplay();
            rerender();
        });

        zoomFit.addEventListener('click', () => {
            // Calculate scale to fit container width
            const containerWidth = viewerContainer.clientWidth - 40; // padding
            if (loadedPdfs.length > 0) {
                loadedPdfs[0].getPage(1).then(page => {
                    const viewport = page.getViewport({ scale: 1 });
                    currentScale = containerWidth / viewport.width;
                    updateZoomDisplay();
                    rerender();
                });
            }
        });

        // Debounce function for search
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        const handleSearch = debounce(() => {
            const query = search.value.toLowerCase().trim();

            // Filter entries
            currentEntries = allEntries.filter(entry => entry.name.toLowerCase().includes(query));

            // Rebuild select
            pageSelect.innerHTML = '';
            currentEntries.forEach((entry, idx) => {
                const option = document.createElement('option');
                option.value = idx;
                option.dataset.name = entry.name.toLowerCase();
                option.textContent = `${entry.name} (${entry.pages.join(', ')})`;
                pageSelect.appendChild(option);
            });

            updateViewer();
        }, 150);

        search.addEventListener('input', handleSearch);

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.target === search) return;

            if (e.key === 'ArrowLeft') {
                prevBtn.click();
            } else if (e.key === 'ArrowRight') {
                nextBtn.click();
            } else if (e.key === '+' || e.key === '=') {
                zoomIn.click();
            } else if (e.key === '-') {
                zoomOut.click();
            }
        });

        // Initialize
        updateZoomDisplay();
        updateViewer();
    </script>
</body>
</html>